---
title: "Laboration 3"
author: "Yinyi Yao Esbjörn Runesson"
date: "`r Sys.Date()`"
output: 
  html_document:
    fig_caption: yes
---

# Sammanfattning
Denna laboration syftar till att analysera och modellera förändringar i jordens medeltemperatur över tid med hjälp av linjär regression. Den första uppgiften fokuserar på att utforska globala temperaturavvikelser mellan åren 1850 och 2007 genom att skapa visualiseringar, utföra enkel linjär regression och utvärdera modellens förutsättningar. I den andra uppgiften delas data upp i tre tidsperioder för att undersöka om modellen förbättras när kortare tidsserier används, samt för att testa hypoteser kring klimatförändringar under senare år. Slutligen utforskar vi i den tredje uppgiften modellens prediktiva förmåga genom att jämföra olika regressionsmodeller och deras förmåga att förutsäga temperaturavvikelser under perioden 2008–2022. Fokus ligger på att tolka resultaten, identifiera modellens begränsningar och föreslå förbättringar för framtida analyser.

# Uppgift 1

I denna uppgift ska vi undersöka avvikelsen av jordens medeltemperatur mellan åren 1850-2007 i jämförelse med genomsnittet för perioden 1961-1990 genom att läsa in filen temperatur.csv och sedan undersöka med hjälp av scatterplot om sambandet verkar linjärt. Sedan genomför vi en enkel linjär regression och undersöker linjen som tillkommer i vår scatterplot för att dra slutsatser om det potentiella linjära sambandet i vår data.

1. Vi börjar här med att göra en scatterplot med den globala temperaturen på y-axeln och årtal på x-axeln för att se om sambandet verkar linjärt eller inte

```{r, fig.cap="Jordens medeltemperatur plottad mot år 1850--2007"}
df <- read.csv("temperatur.csv", header = TRUE)
plot(df$år, df$temperatur, xlab = "År", ylab = "Temperatur",main = 'Scatterplot över jordens medeltemperatur mellan 1850-2007')
```

Scatterploten mellan år och global medeltemperatur visar en tydlig uppåtgående trend, vilket tyder på att temperaturen ökar med tiden. Sambandet ser över stora delen av perioden inte strikt linjärt ut, utan det förekommer uppenbara avvikelser och variation som tyder på att sambandet ej är linjärt.

2. För att utföra en enkel linjär regression behöver följande förutsättningar vara uppfyllda:

 a.Lineäritet: Sambandet mellan den förklarande variabeln (år) och responsvariabeln (temperatur) ska vara linjärt.
 b.Oberoende: Observationerna ska vara oberoende av varandra (ingen inbördes påverkan).
 c.Homoscedasticitet: Variansen i residualerna (skillnaderna mellan observerade och förväntade värden) ska vara konstant över alla värden på den förklarande variabeln.
 d.Normalfördelade residualer: Residualerna ska följa en normalfördelning, vilket kan kontrolleras med en normalfördelningsplot.

3. Vi genomför här en enkel linjär regression av den globala medeltemperaturen (temperatur) som responsvariabel och och årtal (år) som förklarande variabel och plottar sedan regressionslinjen i vår scatterplot

```{r, fig.cap = 'Anpassad modell'}
df <- read.csv("temperatur.csv", header = TRUE)
modell <- lm(temperatur ~ år, data = df)
summary(modell)
plot(df$år, df$temperatur, xlab = "År", ylab = "Temperatur",main = 'Regressionsmodell för jordens medeltemperatur mellan 1850-2007')
abline(modell, col = "blue")
```

En enkel linjär regression genomfördes där temperaturen (responsvariabel) förklaras av år (förklarande variabel). Regressionslinjen lades till scatterploten, vilket visar att linjen generellt passar bra till datan. Dock finns vissa avvikelser, särskilt i de tidigare åren, vilket antyder att modellen inte fångar alla variationer i datan.

4. Vi vill nu avgöra om förutsättningarna för enkel linjär regression är uppfyllda för vårt datamaterial med hjälp av en residualplot samt normalfördelningsplot

```{r,fig.cap = 'Residual samt normalfördelningsplot'}
residual <- modell$residuals
plot(df$år, residual, xlab ="År", ylab="Residual", main = 'Residualplot för jordens medeltemperatur mellan 1850-2007')
abline(a = 0, b = 0, lty = "dotted")
qqnorm(residual,main = 'Normalfördelningsplot för residualer',xlab = 'Normalfördelningens teoretiska kvantiler', ylab = 'Residualer')
qqline(residual)
```


Residualerna (skillnaden mellan observerade och förutsagda värden) är spridda runt noll med ett systematiskt mönster, vilket tyder på att linearitetsantagandet inte är rimligt uppfyllt. Det finns även vissa tecken på varierande spridning vilket kan tyda på att homoscedasticiteten inte är uppfylld.  Q-Q-plottens residualer ligger nära den förväntade linjen för en normalfördelning, vilket indikerar att antagandet om normalfördelning är rimligt uppfyllt. Det finns dock mindre avvikelser i svansarna (outliers).

Slutsaterna: 

- Lineäritet: Ej uppfyllt med avvikelser.
- Oberoende: Antas uppfyllt eftersom datan består av årliga observationer.
- Homoscedasticitet: Verkar ej vara uppfyllt, det finns tecken på varierande spridning i residualerna.
- Normalfördelade residualer: Uppfyllt med försumbara outliers.

Även om vissa antaganden inte är perfekta, ger modellen en användbar approximation av sambandet mellan år och global medeltemperatur.


# Uppgift 2

I denna uppgift ska vi dela in vårt datamaterial i tre separata tidsperioder (1880-1929,1930-1969,1970-2007) och sedan utföra liknande enkla linjära regression men denna gång en för varje indelning i tidsperiod som angavs ovan. Vi ska i varje enskilt fall undersöka om förutsättningarna för enkel linjär regression är bättre uppfyllda, samt ange punktskattningarna av intercept $\alpha$ samt lutningskoefficient $\beta$ för den enkla linjära regressionen. Sedan kommer vi testa hypotesen "Det finns ingen bevisad trend mot ett varmare klimat" med signifikansnivå $\alpha = 0.05$ för perioden 1970-2007 genom ett ensidigt test, konstruera vår nollhypotes samt alternativhypotes och sedan testa dessa.

1. Vi delar nu in datamaterialet i tre separata tidsperioder och undersöker om förutsättningarna för enkel linjär regression är bättre uppfyllda för dessa. Vi börjar med att undersöka perioden 1880-1929


```{r, fig.cap="Jordens medeltemperatur plottad mot år 1880-1929"}
df1 <- subset(df, år >= 1880 & år <=1929)
#plot(df1$år, df1$temperatur, xlab = "År", ylab = "Temperatur")
modell1 <- lm(temperatur ~ år, data = df1)
summary(modell1)
plot(df1$år, df1$temperatur, xlab = "År", ylab = "Temperatur",main = 'Regressionsmodell för jordens medeltemperatur mellan 1880-1929')
abline(modell1, col = "blue")
```

Vi ser här att vi har skattningarna av intercept $\alpha = 1.2849781$ samt lutningskoefficient $\beta = -0.0008419$ och förutsättningarna för enkel linjär regression är ej bättre uppfyllda. Vi fortsätter nu med perioden 1930-1969

```{r, fig.cap="Jordens medeltemperatur plottad mot år 1930-1969"}
df2 <- subset(df, år >= 1930 & år <=1969)
modell2 <- lm(temperatur ~  år, data = df2)
summary(modell2)
plot(df2$år, df2$temperatur, xlab = "År", ylab = "Temperatur",main = 'Regressionsmodell för jordens medeltemperatur mellan 1930-1969')
abline(modell2, col = "blue")
```

Vi har här skattningarna av intercept $\alpha = -0.9199713$ samt lutningskoefficient $\beta = 0.0004318$ och förutsättningarna för enkel linjär regression är ej bättre uppfyllda. Vi fortsätter nu med perioden 1970-2007


```{r, fig.cap="Jordens medeltemperatur plottad mot år 1970-2007"}
df3 <- subset(df, år >= 1970 & år <=2007)
modell3 <- lm(temperatur ~ år, data = df3)
summary(modell3)
plot(df3$år, df3$temperatur, xlab = "År", ylab = "Temperatur",main = 'Regressionsmodell för jordens medeltemperatur mellan 1970-2007')
abline(modell3, col = "blue")
```

Vi har här skattningarna av intercept $\alpha = -34.627751$ samt lutningskoefficient $\beta = 0.017527$ och förutsättningarna för enkel linjär regression verkar här vara bättre uppfyllda.

2.Hypotesprövning för perioden 1970–2007

$H_0$: Det finns ingen bevisad trend mot ett varmare klimat ($\beta$ =0)

$H_1$: $\beta$ >0

```{r}
p_value <- summary(modell3)$coefficients[2, 4]
print(p_value)
if (p_value < 0.05) {
  print("Nollhypotesen förkastas. Det finns en positiv trend.")
} else {
  print("Nollhypotesen kan inte förkastas. Ingen signifikant trend observeras.")
}
```


# Uppgift 3

```{r}
df_test <- read.csv("temperatur_test.csv", header = TRUE)
```

pred <- predict(modell, newdata = df_test, interval = "predict")
pred3 <- predict(modell3, newdata = df_test, interval = "predict")

# Uppgift 3.1

1.
2.
3.

# Uppgift 3.2

1.
2.
3.