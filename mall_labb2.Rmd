---
title: "Laboration 2"
author: "Yinyi Yao Esbjörn Runesson"
date: "`r Sys.Date()`"
output:
  html_document:
    df_print: paged
  pdf_document:
    fig_caption: true
---

# Sammanfattning
I denna laboration så kommer vi att undersöka med hjälp av hypotesttest och
Wilcoxons teckenrangtest samt Wilcoxon-Mann-Whitneytest om effekten av molnsådd ökar nederbörden för respektive
område. I den första uppgiften delas försöksperioden in tvådagarsperioder där
molnsådd utförs den första dagen men inte den andra, och på sätt har man en
grund för jämförelse. I den andra uppgiften användes i stället en slumptalsgenerator 
om molnsådd ska utföras, där sannolikheten för att genomföra är $2/3$ och sannolikheten 
för att avstå är $1/3$. Resultatet av detta var att molnsådd genomfördes 22 dagar
och genomfördes ej i 13 dagar. I båda dessa uppgifter så undersöker vi till att
börja med om den datamängd vi erhåller genom respektive csv-fil kan anses
härstamma från någon fördelning med hjälp av normalfördelningsplot, histogram
och boxplot. Efter det genomför vi hypotestest med nollhypotes att molnsådd inte
påverkar nederbörden kontra alternativhypotesen att molnsådd ökar nederbörden.
För att genomföra dessa hypotest så använder vi oss av Wilcoxons teckenrangtest 
samt Wilcoxon-Mann-Whitneytest för att få fram ett p-värde och se om det är större
eller mindre än vår felrisk för att dra slutsats om att inte förkasta nollhypotesen
kontra förkasta nollhypotesen.

# Uppgift 1: Molnsådd i Arizona
## Uppgift 1.1: Teoretisk uppgift
1. Indelningen i tvådagarsperioden säkerställer att varje dag med molnsådd har en motsvarande kontroll dag (utan molnsådd) dagen efter. Detta gör det möjligt att direkt jämföra resultatet mellan dessa två dagar
och se hur då påverkar varandra. Dessutom så blir fördelningen av dagarna då
molnsådd beströs och inte beströs jämnare och riskerar inte att beströ molnsådd
flera dagar i rad som skulle kunna ske med fallet då man singlar slant.
2. Eftersom det slumpmässiga valet av vilken dag molnsådd ska genomföras i en
tvådagarsperiod minimerar systematiska fel, förstärker sannolikheten att 
korrelationen mellan den dag då molnsådd beströs och dagen efter då den inte beströs
faktist är legitim.
3. För att testa om molnsådd ökar mängden nederbörd jämfört med dagar utan molnsådd, kan vi använda följande statistiska tester beroende på datans egenskaper:
 t-test: om datan är kvantitativ, normalfördelad (eller tillräckligt stor sample-storlek för att approximera normalitet). Vi kan jämföra medelvärdet av nederbörd mellan dagar med och utan molnsådd för att testa om skillnaden är signifikant.
 teckenrangtest: Om datan är kvantitativ men inte normalfördelad. Det är ett icke-parametriskt alternativ till parat t-test som jämför medianen av skillnader mellan olika grupper.
Men eftersom vår data ej är normalfördelad Är Wilcoxons teckenrangtest det 
lämpliga valet för att testa om molnsådd ökar mängden nederbörd.

## Uppgift 1.2 Praktisk uppgift
I denna uppgift vill vi undersöka om vårt datamaterial baserat på en nederbörd med
molnsådd, nederbörd utan molnsådd samt deras årtal kan ha någon fördelning. (Vi
vill dessutom konstruera en nollhypotes för att testa med Wilcoxons teckenrangtest
om det är så att molnsådd ökar nederbörden.) Till att börja med undersöker vi med
hjälp av boxplot, histogram och normalfördelningsplot om vårt datamaterial kan komma
från någon fördelning.

```{r}
arizona <- read.csv("arizona.csv", header = FALSE)
year <- arizona$V1
seed <- arizona$V2
nonseed <- arizona$V3
qqnorm(seed,main = 'Nederbörd med molnsådd', ylab= 'Nederbörd med
molnsådd', xlab= 'Normalfördelningens teoretiska kvantiler')
qqline(seed)
```


```{r}
qqnorm(nonseed,main = 'Nederbörd utan molnsådd', ylab= 'Nederbörd utan
molnsådd', xlab= 'Normalfördelningens teoretiska kvantiler')
qqline(nonseed)
```


```{r}
hist(nonseed,prob = TRUE, main = 'Nederbörd utan molnsådd', ylab =
       'Densitet', xlab = 'Nederbörd utan molnsådd')
```


```{r}
hist(seed,prob = TRUE, main = 'Nederbörd med molnsådd', ylab =
       'Densitet', xlab = 'Nederbörd med molnsådd')
```


```{r}
boxplot(nonseed, prob = TRUE, main = 'Nederbörd utan molnsådd')
```


```{r}
boxplot(seed, prob = TRUE, main = 'Nederbörd med molnsådd')
```


Vi ser då att vårt datamaterial inte verkar komma från en särskild fördelning.
Vi fortsätter nu med att göra ett diagram för differensen mellan nederbörden
med molnsådd och utan molnsådd, för att sedan konstruera vår nollhypotes och
utföra Wilcoxons teckentangtest.

```{r fig.cap="Diagram för nederbörd med molnsådd och utan molnsådd"}
differ <- seed-nonseed
old_par <- par(mfrow = c(1,2))
plot(year,seed, xlab= '
Årtal', ylab = 'Nederbörd',
pch = 15,
col ="blue")
points(year,nonseed,
       pch = 17,  # Solid triangles
       col = "red")
legend("topright", 
       legend = c("Seed", "Nonseed"), 
       pch = c(15, 17),  # Shapes corresponding to seed and nonseed
       col = c("blue", "red"))  # Colors corresponding to seed and nonseed
plot(year,differ, ylab= 'differenserna', xlab = 'Årtal')
par(old_par)
```
```{r}
plot(year, seed, 
     main = 'Diagram för nederbörd med molnsådd och utan molnsådd', 
     xlab = 'Årtal', 
     ylab = 'Nederbörd', 
     pch = 15,  # Solid squares for seed
     col = "blue")
points(year, nonseed, 
       pch = 17,  # Solid triangles for nonseed
       col = "red")

# Add a legend
legend("topright", 
       legend = c("Seed", "Nonseed"), 
       pch = c(15, 17),  # Shapes corresponding to seed and nonseed
       col = c("blue", "red"))  # Colors corresponding to seed and nonseed
```
```{r}
plot(year,differ,main = 'Diagram för differenserna mellan nederbörd utan molnsådd och nederbörd med molnsådd', ylab= 'differenserna', xlab = 'Årtal')
```


Sammanfattande texter
Histogram, box plot och Q-Q-plottar visade att dataset inte var normalfördelade, vi väljer icke-parametrisk metod: teckenrangtest (Wilcoxon signed-rank test).

## Hypotes
$H_0$: Det finns ingen skillnad i nederbörd mellan molnsådda och icke-molnsådda dagar. Molnsådd har ingen effekt.

$H_1$: Molnsådd ökar nederbörden.

```{r}
wilcox.test(differ, alternative = "greater", paired = FALSE)## tror att jag har gjort fel med syntax, se syntax nedan
```
```{r}
wilcox.test(seed, nonseed, alternative ="greater",paired = TRUE) #vi har samma mängd på 2 grupper, och kan se datan beroende, därför paired= TRUE
```


Och vi ser då att $p > \alpha = 0.05$ så vi kan därför inte förkasta $H_{0}$ vilket innebär
att molnsådd inte verkar öka nederbörden.

# Uppgift 2: Molnsådd i Oregon
## Uppgift 2.1: Teoretisk uppgift
1. För att undvika det systematiska fel som kan uppstå då exempelvis en meteorolog
får avgöra när försöket ska genomföras, där den förutsägbarhet som där förekommer
undviks genom att låta slumpen avgöra.
2. Wilcoxons-Mann-Whitneytest eftersom denna på samma sätt som tecken-rangtestet 
bör användas då vår datamängd inte verkar normalfördelad, men då vi nu har två
datavektorer i stället för enbart en som i Wilcoxons teckenrangtest.

## Uppgift 2.2: Praktisk uppgift

I denna uppgift så vill vi avgöra om molnsådd ökar nederbörden i Oregon där en
meteorolog varje morgon bedömmer om förutsättningarna för nederbörd är lämpliga
senare under dagen, om sådant var fallet så används en slumptalsgenerator med 
sannolikhet $2/3$ att göra ett försök den dagen samt sannolikhet $1/3$ att avstå.
Resultatet var att molnsådd genomfördes 22 dagar och genomfördes ej 13 dagar och
vi vill avgöra om den datamängd från dessa tester har någon fördelning, samt konstruera
en nollhypotes, alternativhypotes för att sedan testa om molnsådd ökar nederbörden.
Vi börjar med att undersöka om vår datamängd kan komma från någon fördelning
med hjälp av histogram, boxplot och normalfördelningsplot

```{r}
oregon <- read.csv("oregon.csv", header = FALSE) #Yinyi testa använda denna istället
trial <- oregon$V1
typ1 <- oregon$V2
typ2 <- oregon$V3
nonseed1 <- typ1[trial == 1]
seed1 <- typ1[trial == 2]
nonseed2 <- typ2[trial == 1]
seed2 <- typ2[trial == 2]
old_par <- par(mfrow = c(2,3))
qqnorm(seed1,main = 'Nederbörd med molnsådd i område 1', ylab= 'Nederbörd med
molnsådd', xlab= 'Normalfördelningens teoretiska kvantiler')
qqline(seed1)
qqnorm(nonseed1,main = 'Nederbörd utan molnsådd i område 1', ylab= 'Nederbörd utan
molnsådd', xlab= 'Normalfördelningens teoretiska kvantiler')
qqline(nonseed1)
qqnorm(seed2,main = 'Nederbörd med molnsådd i område 2', ylab= 'Nederbörd med
molnsådd', xlab= 'Normalfördelningens teoretiska kvantiler')
qqline(seed2)
qqnorm(nonseed2,main = 'Nederbörd utan molnsådd i område 2', ylab= 'Nederbörd utan
molnsådd', xlab= 'Normalfördelningens teoretiska kvantiler')
qqline(nonseed2)
par(old_par)
```

Och vi kan här se att den data som kommer från nederbörd med molnsådd i område 1
efterliknar linjen i vår normalfördelningsplot och den verkar därmed vara 
normalfördelad. Vi fortsätter med att undersöka histogram och boxplot

```{r}
old_par <- par(mfrow = c(2,3))
hist(nonseed1,prob = TRUE, main = 'Nederbörd utan molnsådd i område 1', ylab =
       'Densitet', xlab = 'Nederbörd utan molnsådd')
hist(seed1,prob = TRUE, main = 'Nederbörd med molnsådd i område 1', ylab =
       'Densitet', xlab = 'Nederbörd med molnsådd')
hist(nonseed2,prob = TRUE, main = 'Nederbörd utan molnsådd i område 2', ylab =
       'Densitet', xlab = 'Nederbörd utan molnsådd')
hist(seed2,prob = TRUE, main = 'Nederbörd med molnsådd i område 2', ylab =
       'Densitet', xlab = 'Nederbörd med molnsådd')
par(old_par)
old_par <- par(mfrow = c(2,3))
boxplot(nonseed1, prob = TRUE, main = 'Nederbörd utan molnsådd i område 1')
boxplot(seed1, prob = TRUE, main = 'Nederbörd med molnsådd i område 1')
boxplot(nonseed2, prob = TRUE, main = 'Nederbörd utan molnsådd i område 2')
boxplot(seed2, prob = TRUE, main = 'Nederbörd med molnsådd i område 2')
par(old_par)

```

Vi kan då se att vår normalfördelningsplot över nederbörd med molnsådd i område 1
visade att denna datamängd är normalfördelad medan det är svårare att se med 
boxplot och histogram. Vi ska nu fortsätta genom att konstruera en nollhypotes 
samt alternativhypotes och sedan testa med hjälp av Wilcoxons teckenrang-test 
för de två områdena om molnsådd ökar nederbörden.
$H_{0}$: Molnsådd påverkar inte nederbörden
$H_{1}$: Molnsådd ökar nederbörden
```{r}
wilcox.test(seed1, nonseed1, alternative = "greater", paired = FALSE) # två grupper har olika mängd, därför är de oberoende (paired=FALSE)
wilcox.test(seed2, nonseed2, alternative = "greater", paired = FALSE)
```

Vi kan här se att Wilcoxons-Mann-Whitney test för båda områdena gav $p > \alpha = 0.05$
så vi förkastar därför inte nollhypotesen och därmed ökar molnsådd inte nederbörden.